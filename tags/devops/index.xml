<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Devops on Svtter's Blog</title><link>https://svtter.cn/tags/devops/</link><description>Recent content in Devops on Svtter's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sat, 27 Jan 2018 01:00:00 +0800</lastBuildDate><atom:link href="https://svtter.cn/tags/devops/index.xml" rel="self" type="application/rss+xml"/><item><title>使用Fabric进行部署</title><link>https://svtter.cn/p/%E4%BD%BF%E7%94%A8fabric%E8%BF%9B%E8%A1%8C%E9%83%A8%E7%BD%B2/</link><pubDate>Sat, 27 Jan 2018 01:00:00 +0800</pubDate><guid>https://svtter.cn/p/%E4%BD%BF%E7%94%A8fabric%E8%BF%9B%E8%A1%8C%E9%83%A8%E7%BD%B2/</guid><description>&lt;blockquote&gt;
&lt;p&gt;Fabric是一个可以在远程机器上运行命令的库&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Fabric官方目前只支持Python2版本，但是有勤劳的人开发出了适配Python3的版本。具体可以查看这个&lt;a class="link" href="https://github.com/mathiasertl/fabric/" target="_blank" rel="noopener"
&gt;fork&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id="fabric的使用"&gt;Fabric的使用
&lt;/h2&gt;&lt;p&gt;我在使用Fabric的时候主要是用于部署我的网站。使用时候，首先需要引入所有的API：&lt;/p&gt;
&lt;div class="codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 导入Fabric API:&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;fabric.api&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;这样就可以导入Fabric的API进行远程控制啦。&lt;/p&gt;
&lt;h2 id="具体问题"&gt;具体问题
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;git需要输入密码&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;forward_agent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;ssh通过秘钥链接&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 使用秘钥&lt;/span&gt;
&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;key_filename&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/Users/xiuhao/.ssh/key&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;使用root&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 服务器登录用户名:&lt;/span&gt;
&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ubuntu&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;# sudo用户为root:&lt;/span&gt;
&lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sudo_user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;root&amp;#39;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;h2 id="一个简单的部署例子"&gt;一个简单的部署例子
&lt;/h2&gt;&lt;p&gt;这个部署例子结合了更新代码，进入指定目录，运行命令等。&lt;/p&gt;
&lt;div class="codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;BASE_DIR&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/home/ubuntu/django_blog&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;deploy&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;span class="sd"&gt;"""&lt;/span&gt;
&lt;span class="sd"&gt; deploy new changes&lt;/span&gt;
&lt;span class="sd"&gt; """&lt;/span&gt;
&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;cd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BASE_DIR&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;git pull&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;make down&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;make up&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;写好文件以后，保存为&lt;code&gt;fabfile.py&lt;/code&gt;，运行&lt;code&gt;fab deploy&lt;/code&gt;即可部署。&lt;code&gt;deploy&lt;/code&gt;对应着&lt;code&gt;deploy()&lt;/code&gt;函数。&lt;/p&gt;
&lt;p&gt;NOTE：不在远程服务器上使用ssh的git仓库，是因为担心服务器被&lt;code&gt;hack&lt;/code&gt;连累我的&lt;code&gt;git repo&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id="参考资料"&gt;参考资料
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="link" href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014323392805925d5b69ddad514511bf0391fe2a0df2b0000" target="_blank" rel="noopener"
&gt;廖雪峰 15days&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://github.com/mathiasertl/fabric/" target="_blank" rel="noopener"
&gt;python3-fabric&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item></channel></rss>