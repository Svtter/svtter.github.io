<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Django on Svtter's Blog</title><link>https://svtter.cn/tags/django/</link><description>Recent content in Django on Svtter's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 10 Mar 2025 19:34:19 +0800</lastBuildDate><atom:link href="https://svtter.cn/tags/django/index.xml" rel="self" type="application/rss+xml"/><item><title>Django Bridge and Telepath Make Decode Easier.md</title><link>https://svtter.cn/p/django-bridge-and-telepath-make-decode-easier.md/</link><pubDate>Mon, 10 Mar 2025 19:34:19 +0800</pubDate><guid>https://svtter.cn/p/django-bridge-and-telepath-make-decode-easier.md/</guid><description>&lt;p&gt;&lt;a class="link" href="https://wagtail.github.io/telepath/" target="_blank" rel="noopener"
&gt;telepath&lt;/a&gt;是 wagtail 开发的一个库，可以用于对 python 对象进行转换。&lt;/p&gt;
&lt;p&gt;其最大的好处是，将原本复杂的 python class -&amp;gt; JSON -&amp;gt; Javascript class，转换成 python class -&amp;gt; Javascript class。&lt;/p&gt;
&lt;p&gt;更具体的内容可以参考&lt;a class="link" href="https://wagtail.github.io/telepath/tutorial/" target="_blank" rel="noopener"
&gt;tutorial&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;那么有没有可能在这个基础上，让 React 和 Django 直通呢？ &lt;a class="link" href="https://django-bridge.org/docs/introduction/" target="_blank" rel="noopener"
&gt;Django Bridge&lt;/a&gt; 就是做这个工作的。&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://django-bridge.org/docs/introduction/" target="_blank" rel="noopener"
&gt;Django Bridge&lt;/a&gt; 允许用户直接返回 JSON 结构，然后 React 根据 JSON 结构进行解析，对应渲染 React Component。&lt;/p&gt;
&lt;h2 id="问题是什么"&gt;问题是什么
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;学习成本。如果 django bridge 是一个团队中大家都熟悉的东西，那么上手不慢。但是如果大家都不太熟悉，那么引入 django bridge，需要花时间学习。&lt;/li&gt;
&lt;li&gt;调试成本。相比于 http JSON，这种方式依赖于 Django Bridge 对 JSON 的解析。调试起来可能会有一定的困难。&lt;/li&gt;
&lt;li&gt;对于已有的项目，代码中可能存在基本通信框架，那么这个库可能会导致旧代码的改造。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;其他的内容，在&lt;a class="link" href="https://django-bridge.org/docs/introduction/#should-i-use-it" target="_blank" rel="noopener"
&gt;Should I use it?&lt;/a&gt;中有所提及，可供参考。&lt;/p&gt;
&lt;h2 id="有什么优势"&gt;有什么优势
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;虽然是前后端分离，但不需要考虑 session 和 cookie 的管理了。也不需要考虑 JWT 的问题。(是不是分离了也不需要管理呢？)&lt;/li&gt;
&lt;li&gt;官网原文：If you&amp;rsquo;re about to build a web app or SaaS product with Django and React, this library could save you a lot of time. It provides all the necessary tools to integrate a React frontend with Django and includes a project template with simple Vite-based frontend tooling to get you started.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;更多的内容，请移步官网阅读。&lt;/p&gt;</description></item><item><title>New Usage of typing module in python</title><link>https://svtter.cn/p/new-usage-of-typing-module-in-python/</link><pubDate>Fri, 12 Jul 2024 16:20:32 +0800</pubDate><guid>https://svtter.cn/p/new-usage-of-typing-module-in-python/</guid><description>&lt;p&gt;我原本想要分析一下 django webpack；但是写了一半，为了资料论述严谨，又不得不学习了 django component；在 django component 中，又发现了自己之前不知道的一些机制。无奈，先聊聊遇到的 typing 问题吧！&lt;/p&gt;
&lt;p&gt;最近在阅读 django components 代码的时候，我在 &lt;a class="link" href="https://github.com/EmilStenstrom/django-components/blob/master/src/django_components/component_registry.py" target="_blank" rel="noopener"
&gt;component_registry.py&lt;/a&gt; 看到了这样一段代码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;typing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;TYPE_CHECKING&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Callable&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Dict&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;TypeVar&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;TYPE_CHECKING&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django_components&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;component&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;_TC&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;TypeVar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;_TC&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bound&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Type&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;component.Component&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;从中能学到几个知识点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;TYPE_CHECKING 变量是用于程序员处理类型相关代码的 TAG，在实际运行的时候，内部代码不被执行；我们可以从 typing 的&lt;a class="link" href="https://docs.python.org/3/library/typing.html#typing.TYPE_CHECKING" target="_blank" rel="noopener"
&gt;官方文档&lt;/a&gt;中找到。&lt;/li&gt;
&lt;li&gt;TypeVar 可以这样来用：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;S&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;TypeVar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;S&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bound&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# Can be any subtype of str&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;在这段代码处，意味着 &lt;code&gt;_TC&lt;/code&gt; 可以是任何一个 &lt;code&gt;component.Component&lt;/code&gt; 的 &lt;code&gt;subtype&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id="conclusion"&gt;Conclusion
&lt;/h2&gt;&lt;p&gt;python 也在慢慢丰富自己的类型系统，许多新的用法也会慢慢地开发出来。不过相比之下，typescript 的类型系统要更先进一些。大家好好学！&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;附加一点吐槽：Component 居然是一个 django view，感觉很奇怪啊。&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>Django and Webpack</title><link>https://svtter.cn/p/django-and-webpack/</link><pubDate>Sat, 06 Jul 2024 15:21:55 +0800</pubDate><guid>https://svtter.cn/p/django-and-webpack/</guid><description>&lt;p&gt;Webpack is a modern development method for frontend projects. Django is a common backend development framework for Python developers.&lt;/p&gt;
&lt;p&gt;I believe that developing with Webpack can make Django development faster.&lt;/p&gt;
&lt;h2 id="why"&gt;Why
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;webpack&lt;/code&gt; can enable Django developers to use the React ecosystem, and it makes auto-complete and linting available in Django frontend development, especially with VSCode.&lt;/p&gt;
&lt;p&gt;Django developers should integrate Webpack, similar to what &lt;a class="link" href="https://github.com/rails/webpacker?tab=readme-ov-file#webpacker-has-been-retired-" target="_blank" rel="noopener"
&gt;Rails developers did&lt;/a&gt;. At 2024-07-05, Webpack has retired in Rails. They are using &lt;a class="link" href="https://hotwired.dev/" target="_blank" rel="noopener"
&gt;Hotwire&lt;/a&gt; now. For more details, you should read the &lt;a class="link" href="https://rubyonrails.org/2021/12/15/Rails-7-fulfilling-a-vision" target="_blank" rel="noopener"
&gt;Rails 7 blog&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="what-to-choose"&gt;What to Choose?
&lt;/h2&gt;&lt;p&gt;I tested two popular projects on GitHub.&lt;/p&gt;
&lt;p&gt;The first one is &lt;a class="link" href="https://github.com/vintasoftware/django-react-boilerplate" target="_blank" rel="noopener"
&gt;django-react-boilerplate&lt;/a&gt;. It has high stars and ranks second.&lt;/p&gt;
&lt;p&gt;However, as of 2024-07-05, it&amp;rsquo;s not ready. I will continue to track its progress. It is hard and complex to configure the &lt;code&gt;{{ project_name }}&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The second one is &lt;a class="link" href="https://python-webpack-boilerplate.readthedocs.io/en/stable/setup_with_django/" target="_blank" rel="noopener"
&gt;python-webpack-boilerplate&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;It has a gradual process and a good learning curve. I spent just 5 minutes adding Webpack to my &lt;a class="link" href="https://github.com/Svtter/django-webpack-example" target="_blank" rel="noopener"
&gt;example project&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In Django 5.2, &lt;code&gt;simple_block_tag&lt;/code&gt; is &lt;a class="link" href="https://softwarecrafts.co.uk/100-words/day-270" target="_blank" rel="noopener"
&gt;supported&lt;/a&gt;!&lt;/p&gt;
&lt;h2 id="discussion"&gt;Discussion
&lt;/h2&gt;&lt;p&gt;There is still a long way to go.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;React has not been added to the &lt;a class="link" href="https://github.com/Svtter/django-webpack-example" target="_blank" rel="noopener"
&gt;example project&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;A production environment is needed to validate its availability.&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;</description></item><item><title>2024-Q1 Summary</title><link>https://svtter.cn/p/2024-q1-summary/</link><pubDate>Fri, 12 Apr 2024 11:00:07 +0800</pubDate><guid>https://svtter.cn/p/2024-q1-summary/</guid><description>&lt;p&gt;第一季度过的如此之快！效率感觉不高，但实际上做的东西还可以。开心！&lt;/p&gt;
&lt;h2 id="academic"&gt;Academic
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Paper-2 R-3 完成&lt;/li&gt;
&lt;li&gt;active learning, human in the loop, domain adaptation, meter 论文的阅读&lt;/li&gt;
&lt;li&gt;论文审稿&lt;/li&gt;
&lt;li&gt;meter related 老代码整理，数据整理&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="work"&gt;work
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;交付了两个项目&lt;/li&gt;
&lt;li&gt;可以公开的进展：meterhub&lt;/li&gt;
&lt;li&gt;一个 django 插件 &lt;a class="link" href="https://github.com/Svtter/django-login-email" target="_blank" rel="noopener"
&gt;django-email-login&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;一个用于 email 验证登录的工具&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;企业微信设立&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="在下一个季度要完成的事情"&gt;在下一个季度，要完成的事情
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;中期报告&lt;/li&gt;
&lt;li&gt;第二篇小论文中，第三篇小论文投出&lt;/li&gt;
&lt;li&gt;会议论文实验和论文写完投出&lt;/li&gt;
&lt;li&gt;meterhub&lt;/li&gt;
&lt;li&gt;MAYBE 找一个实习工作&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>给老 Django 工程师的初学者 react 教程</title><link>https://svtter.cn/p/%E7%BB%99%E8%80%81-django-%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E5%88%9D%E5%AD%A6%E8%80%85-react-%E6%95%99%E7%A8%8B/</link><pubDate>Tue, 12 Mar 2024 09:38:36 +0800</pubDate><guid>https://svtter.cn/p/%E7%BB%99%E8%80%81-django-%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E5%88%9D%E5%AD%A6%E8%80%85-react-%E6%95%99%E7%A8%8B/</guid><description>&lt;blockquote&gt;
&lt;p&gt;这篇文章的文字水平一般。之所以要写这篇文章，一方面是为了记录自己的开发历程，另一方面是为了少部分同频的伙伴给予引导。也是为了完成每个月博客文章的 KPI。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;前提：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;走完 &lt;a class="link" href="https://react.dev/learn/tutorial-tic-tac-toe" target="_blank" rel="noopener"
&gt;react toturial&lt;/a&gt;，最好能够掌握 useState。&lt;/li&gt;
&lt;li&gt;了解 Javascript 语法，懂得 CSS / HTML&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;近期我用了 nextjs 开发了一个项目。nextjs 是一个可以全栈开发，也可以只开发前端的框架。我的开发内容只包括前端。nextjs 非常好用，简化了大量的复杂配置，可以上手即用。可以直接打开&lt;a class="link" href="https://nextjs.org/docs/getting-started/installation" target="_blank" rel="noopener"
&gt;nextjs官网&lt;/a&gt;来安装使用。
&lt;code&gt;npx create-next-app@latest&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;安装的时候不建议使用 typescript。这是因为 typescript 相对复杂，容易提高学习成本。tailwind 非常好用。要选上。&lt;code&gt;src/&lt;/code&gt; folder 可以不用。&lt;code&gt;eslint&lt;/code&gt; 选上，能解决不少问题。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; What is your project named? my-app
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Would you like to use TypeScript? No / Yes
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Would you like to use ESLint? No / Yes
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Would you like to use Tailwind CSS? No / Yes
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Would you like to use `src/` directory? No / Yes
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Would you like to use App Router? (recommended) No / Yes
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Would you like to customize the default import alias (@/*)? No / Yes
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; What import alias would you like configured? @/*
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="开干"&gt;开干
&lt;/h2&gt;&lt;p&gt;&lt;img src="https://svtter.cn/images/image_1712885644494_0.png"
loading="lazy"
alt="image.png"
&gt;&lt;/p&gt;
&lt;p&gt;我们能看到 app 下面有一个 layout.js，可以理解成 django 全栈开发中的 &lt;code&gt;base.html&lt;/code&gt;。这个在 django 中比较常见。
在 nextjs 中，为了开发样式，一般使用 tailwind css。&lt;a class="link" href="https://tailwindcss.com/docs/installation" target="_blank" rel="noopener"
&gt;tailwind css&lt;/a&gt; 是一个通过 class 编写 style 的框架。学习 tailwind，直接从&lt;a class="link" href="https://tailwindcss.com/docs/utility-first" target="_blank" rel="noopener"
&gt;core concept&lt;/a&gt;开始看就行了。
那么 react 怎么用呢？
在搭建 UI 框架阶段，实际上用到 react 的功能不多。这个时候，想要充分借助 react 的便利性，最重要的是掌握 component 这个概念。简单来说，就是能够自己创建 html tag，并且将 function 和 tag 映射起来。
创建一个 html tag&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-jsx" data-lang="jsx"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;Hello&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nx"&gt;hello&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;world&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;这样就创建好了一个 &lt;code&gt;&amp;lt;Hello&amp;gt;&lt;/code&gt; tag。在后续中可以使用这个 tag 了。
例如，我们在 &lt;code&gt;page.js&lt;/code&gt; 下面使用&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;Home&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;div&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;Hello&lt;/span&gt;&lt;span class="o"&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="err"&gt;/div&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;这样 Hello 就被渲染出来了。
除此之外，还有一个难点就是，组件之间怎么传递参数。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-jsx" data-lang="jsx"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;Hello&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;props&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;props&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nx"&gt;hello&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;}&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;通过 props 就可以传递参数了。&lt;/p&gt;
&lt;h2 id="延申阅读"&gt;延申阅读
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="link" href="https://github.com/Hsins-Learn/Learn-Full-Stack-Development-with-Django-and-React" target="_blank" rel="noopener"
&gt;https://github.com/Hsins-Learn/Learn-Full-Stack-Development-with-Django-and-React&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="结语"&gt;结语
&lt;/h2&gt;&lt;p&gt;基本上，掌握以上两个技能就可以开始基于 react 开发前端应用了。
其他的内容直接从 react、nextjs、tailwind 文档中学习即可，遇到不清楚的内容直接查询。&lt;/p&gt;
&lt;p&gt;欢迎将不清楚的问题留言，我会根据留言的内容改进本文。&lt;/p&gt;</description></item><item><title>Use Vue with Django, Meet CSRF</title><link>https://svtter.cn/p/use-vue-with-django-meet-csrf/</link><pubDate>Sun, 03 Sep 2023 14:12:47 +0800</pubDate><guid>https://svtter.cn/p/use-vue-with-django-meet-csrf/</guid><description>&lt;p&gt;在使用 Vue 的时候，如何向 Django 提交 form？&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-js" data-lang="js"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ajax&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nx"&gt;url&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;YOUR_URL_HERE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;X-CSRFToken&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;cookie&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;csrftoken&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nx"&gt;type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;POST&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nx"&gt;dataType&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nx"&gt;success&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nx"&gt;error&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;xhr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;errMsg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;django docs: &lt;a class="link" href="https://docs.djangoproject.com/en/1.11/ref/csrf/#ajax" target="_blank" rel="noopener"
&gt;https://docs.djangoproject.com/en/1.11/ref/csrf/#ajax&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="reference"&gt;Reference
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="link" href="https://stackoverflow.com/questions/43567052/csrf-token-of-django-into-vuejs-when-seperate-them" target="_blank" rel="noopener"
&gt;stackoverflow answer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Crazy Import</title><link>https://svtter.cn/p/crazy-import/</link><pubDate>Mon, 09 May 2022 14:02:27 +0800</pubDate><guid>https://svtter.cn/p/crazy-import/</guid><description>&lt;p&gt;最近发现 Django settings 在使用的时候，容易出现不经过检查的问题。
因此，想要在 settings 的基础上严格约束一下，减少问题。&lt;/p&gt;
&lt;p&gt;在进行相关技术调研的时候，发现了&lt;a class="link" href="https://github.com/orlnub123/django-class-settings" target="_blank" rel="noopener"
&gt;django-class-settings&lt;/a&gt;这个库。
实现方式很有意思，于是就调研了一下，学习到了很多新的东西。&lt;/p&gt;
&lt;p&gt;这个库的核心思想，是在代码中，把一个类转换成一个 module；
这非常酷，让我们看看这是如何实现的。&lt;/p&gt;
&lt;p&gt;按照代码的阅读思路，我们首先看看这个包的用法&amp;hellip;&lt;/p&gt;
&lt;p&gt;以下是&lt;a class="link" href="https://github.com/orlnub123/django-class-settings/blob/master/README.md" target="_blank" rel="noopener"
&gt;README.md&lt;/a&gt;中的内容；&lt;/p&gt;
&lt;p&gt;django-class-settings aims to simplify complicated settings layouts by using
classes instead of modules. Some of the benefits of using classes include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Real inheritance&lt;/li&gt;
&lt;li&gt;[Foolproof settings layouts][local_settings]&lt;/li&gt;
&lt;li&gt;Properties&lt;/li&gt;
&lt;li&gt;Implicit environment variable names&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="example"&gt;Example
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# .env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;DJANGO_SECRET_KEY&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;*2#fz@c0w5fe8f-&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;DJANGO_DEBUG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# manage.py&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;class_settings&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;class_settings&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.core.management&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;execute_from_command_line&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read_env&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setdefault&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;DJANGO_SETTINGS_MODULE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;myproject.settings&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;environ&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setdefault&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;DJANGO_SETTINGS_CLASS&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;MySettings&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;class_settings&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;execute_from_command_line&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# myproject/settings.py&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;class_settings&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Settings&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MySettings&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Settings&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;SECRET_KEY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;DEBUG&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;INSTALLED_APPS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s1"&gt;&amp;#39;django.contrib.admin&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s1"&gt;&amp;#39;django.contrib.auth&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s1"&gt;&amp;#39;django.contrib.contenttypes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s1"&gt;&amp;#39;django.contrib.sessions&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s1"&gt;&amp;#39;django.contrib.messages&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="s1"&gt;&amp;#39;django.contrib.staticfiles&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;ROOT_URLCONF&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;myproject.urls&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;WSGI_APPLICATION&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;myproject.wsgi.application&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="installation"&gt;Installation
&lt;/h2&gt;&lt;p&gt;Install it from [PyPI][pypi-url] with [pip][pip-url]:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;pip install django-class-settings
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;我们可以看到，这个类关键入口可能在&lt;code&gt;env.read_env()&lt;/code&gt;以及&lt;code&gt;class_settings.setup()&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;我们首先看一下 &lt;code&gt;src.class_settings.env&lt;/code&gt; 的代码。可以发现，这个代码用于加载 django 中的 env；
因此不是我们关注的重点。&lt;/p&gt;
&lt;p&gt;让我们再看看关键函数 setup。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;src/class_settings/__init__.py&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;__all__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;Env&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;Settings&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;env&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;setup&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;__version__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;0.3.0-dev&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.env&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Env&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.settings&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Settings&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.conf&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;settings&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.utils.functional&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;SimpleLazyObject&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;.importers&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;SettingsImporter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;LazySettingsModule&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;global&lt;/span&gt; &lt;span class="n"&gt;_setup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;_setup&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;meta_path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SettingsImporter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;default_settings&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;LazySettingsModule&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;settings_module&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SimpleLazyObject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;default_settings&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SETTINGS_MODULE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;default_settings&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;SETTINGS_MODULE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings_module&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;_setup&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;_setup&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;在&lt;code&gt;.settings.py&lt;/code&gt;中没有直接加载的代码，因此，我们可以直接阅读本文件。&lt;/p&gt;
&lt;p&gt;未完待续&amp;hellip;&lt;/p&gt;</description></item><item><title>ORM 中的 Pattern</title><link>https://svtter.cn/p/orm-%E4%B8%AD%E7%9A%84-pattern/</link><pubDate>Sat, 20 Nov 2021 10:00:32 +0800</pubDate><guid>https://svtter.cn/p/orm-%E4%B8%AD%E7%9A%84-pattern/</guid><description>&lt;blockquote&gt;
&lt;p&gt;最近在做技术选型，想要引入一些新的开发语言，开发技术到技术团队。大众编程语言在 WEB 方面的稳定性，已经被人所熟知了。但是数据库版本控制方面，每个程序设计语言做的深度和稳定性都有所区别。数据库版本控制和 ORM 密切相关。而&amp;hellip;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;提到 ORM，就不得不聊聊 &lt;code&gt;ActiveRecord&lt;/code&gt;和&lt;code&gt;DataMapper&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id="datamapper"&gt;DataMapper
&lt;/h2&gt;&lt;p&gt;DataMapper 是一种 ORM&amp;rsquo;s pattern。&lt;/p&gt;
&lt;p&gt;一般，使用 DataMapper，你会将所有的查询方法写到 &lt;code&gt;repositories&lt;/code&gt;里面。所有的数据操作都会在&lt;code&gt;repositories&lt;/code&gt;中进行。例如增加，加载，删除，查询。使用&lt;code&gt;DataMapper&lt;/code&gt;的时候，entity 会显得有些“呆滞”。一般情况下，定义好属性和一点简单的方法，不会频繁的 entity 进行操作了。&lt;/p&gt;
&lt;p&gt;所以，大多数情况下，程序员使用 repositories 与数据库进行交互。&lt;/p&gt;
&lt;p&gt;这种模式常见于&lt;code&gt;Spring JPA&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id="activerecord"&gt;ActiveRecord
&lt;/h2&gt;&lt;p&gt;在 &lt;code&gt;ActiveRecord&lt;/code&gt; 模式中，model 的属性和方法，全都在一起定义。&lt;/p&gt;
&lt;p&gt;所以，在大多数情况下，程序员直接使用 &lt;code&gt;model&lt;/code&gt;与数据库进行交互。&lt;/p&gt;
&lt;p&gt;这种模式常见于 &lt;code&gt;Django&lt;/code&gt; 和 &lt;code&gt;Ruby on rails&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id="我应该选择哪一种"&gt;我应该选择哪一种？
&lt;/h2&gt;&lt;p&gt;选择哪一种 ORM pattern 取决当前的应用环境。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Data Mapper&lt;/code&gt; 因为其分离性，在大型应用的开发中往往会更有效率&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Active Record&lt;/code&gt; 使得编写 ORM 变得很容易，因此在小型应用中很受欢迎。&lt;code&gt;Simplicity&lt;/code&gt; 往往是可维护性的一个关键指标。&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Django tricks</title><link>https://svtter.cn/p/django-tricks/</link><pubDate>Tue, 08 Jan 2019 01:00:00 +0800</pubDate><guid>https://svtter.cn/p/django-tricks/</guid><description>&lt;h2 id="关于-session"&gt;关于 session
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://docs.djangoproject.com/en/2.1/_modules/django/contrib/sessions/middleware/#SessionMiddleware" target="_blank" rel="noopener"
&gt;django.contrib.sessions.middleware | Django documentation | Django&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;session 是使用 cookie 来进行判断的，通过 session_cookie_name 来提取，然后通过 SessionStore() 来保存。&lt;/p&gt;
&lt;p&gt;因此，Django 也是通过 sessionid 来区分用户；（或者其他什么名称）。&lt;/p&gt;
&lt;h2 id="使用-cache-作为全局变量"&gt;使用 cache 作为全局变量
&lt;/h2&gt;&lt;p&gt;cache.set(‘foo’, ‘bar’) # another function cache.get(‘foo’) # get ‘bar’&lt;/p&gt;
&lt;p&gt;使用 cache , &lt;code&gt;django-redis&lt;/code&gt; 是一个好方法。可以在使用 &lt;code&gt;cache.lock&lt;/code&gt;变量，在应用层面加锁，来完成异步操作，还可以支持分布式应用，十分方便。&lt;/p&gt;</description></item><item><title>迁移 Django Model id 为 uuid</title><link>https://svtter.cn/p/%E8%BF%81%E7%A7%BB-django-model-id-%E4%B8%BA-uuid/</link><pubDate>Thu, 06 Dec 2018 01:00:00 +0800</pubDate><guid>https://svtter.cn/p/%E8%BF%81%E7%A7%BB-django-model-id-%E4%B8%BA-uuid/</guid><description>&lt;blockquote&gt;
&lt;p&gt;&lt;a class="link" href="https://www.klette.us/migrate-django-models-to-uuid-primary-key/" target="_blank" rel="noopener"
&gt;https://www.klette.us/migrate-django-models-to-uuid-primary-key/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;又是一篇渣翻&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;老设计决策有时候会让你很难受，下面就是一个例子。&lt;/p&gt;
&lt;p&gt;我手上的一个 Django Model 是这样的：&lt;/p&gt;
&lt;pre&gt;&lt;code class=" language-python"&gt;&amp;lt;span class="token keyword"&gt;class&amp;lt;/span&gt; &amp;lt;span class="token class-name"&gt;Municipality&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;Model&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
code &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;CharField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;max_length&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token number"&gt;2&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; primary_key&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token boolean"&gt;True&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
name &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;CharField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;max_length&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token number"&gt;100&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;此外，还有一个外键指向它&lt;/p&gt;
&lt;pre class=" language-python"&gt;&lt;code class=" language-python"&gt;&amp;lt;span class="token keyword"&gt;class&amp;lt;/span&gt; &amp;lt;span class="token class-name"&gt;ZipCode&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;Model&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
code &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;CharField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;max_length&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token number"&gt;2&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; primary_key&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token boolean"&gt;True&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
municipality &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;ForeignKey&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;Municipality&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;现在，我们需要让 municipality 支持多个国家，显然一个唯一 field 将会引起冲突，不够用。（译者：这个理由有点牵强）&lt;/p&gt;
&lt;p&gt;对于所有代码的现代部分，我们使用&lt;code&gt;UUID&lt;/code&gt;作为主键。所以我们想要 migrate &lt;code&gt;municaipality&lt;/code&gt;的主键到&lt;code&gt;UUID&lt;/code&gt;，并且维持了原有的关系。（译者：外键和自增主键都是数据库性能的杀手。）&lt;/p&gt;
&lt;p&gt;2017年9月份，Django 依然不支持优雅的迁移主键，所以我们自己做了（译者：我也不知道现在行不行。）&lt;/p&gt;
&lt;p&gt;我们尝试了许多 magic 解决方案，但是我们在 migrations 系统这个被难住了，并且不能检测以及很好的处理改变。&lt;/p&gt;
&lt;p&gt;在经过一小段研究和错误，我们找到了以下的解决方案。尽管这还有一些小问题，但是的确有效。&lt;/p&gt;
&lt;p&gt;再一次提醒，从数据库的角度，当你定义了一个&lt;code&gt;ForeignKey&lt;/code&gt; field 在 Django 中，Django将会创建一个数据库列，是同样的类型，作为 referenced model 的主键，并且增加外键约束。所以在上面的例子中，我们有两个表：&lt;/p&gt;
&lt;pre class=" language-sql"&gt;&lt;code class=" language-sql"&gt;&amp;lt;span class="token keyword"&gt;CREATE&amp;lt;/span&gt; &amp;lt;span class="token keyword"&gt;TABLE&amp;lt;/span&gt; municipality &amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;
code &amp;lt;span class="token keyword"&gt;varchar&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token number"&gt;2&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt; &amp;lt;span class="token keyword"&gt;PRIMARY&amp;lt;/span&gt; &amp;lt;span class="token keyword"&gt;KEY&amp;lt;/span&gt; &amp;lt;span class="token operator"&gt;NOT&amp;lt;/span&gt; &amp;lt;span class="token boolean"&gt;NULL&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
name &amp;lt;span class="token keyword"&gt;varchar&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token number"&gt;100&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;;&amp;lt;/span&gt;
&amp;lt;span class="token keyword"&gt;CREATE&amp;lt;/span&gt; &amp;lt;span class="token keyword"&gt;TABLE&amp;lt;/span&gt; zipcode &amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;
code &amp;lt;span class="token keyword"&gt;varchar&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token number"&gt;2&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt; &amp;lt;span class="token keyword"&gt;PRIMARY&amp;lt;/span&gt; &amp;lt;span class="token keyword"&gt;KEY&amp;lt;/span&gt; &amp;lt;span class="token operator"&gt;NOT&amp;lt;/span&gt; &amp;lt;span class="token boolean"&gt;NULL&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
municipality_id &amp;lt;span class="token keyword"&gt;VARCHAR&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token number"&gt;2&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt; &amp;lt;span class="token keyword"&gt;REFERENCES&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;municipality&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;id&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt; &amp;lt;span class="token operator"&gt;NOT&amp;lt;/span&gt; &amp;lt;span class="token boolean"&gt;NULL&amp;lt;/span&gt;
&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;;&amp;lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;所以我们需要解除外键约束，更换 root model，然后映射新的主键到旧的上，并且重新应用外键到上面去。&lt;/p&gt;
&lt;p&gt;我们首先打破外键&lt;/p&gt;
&lt;pre class=" language-python"&gt;&lt;code class=" language-python"&gt;&amp;lt;span class="token keyword"&gt;class&amp;lt;/span&gt; &amp;lt;span class="token class-name"&gt;ZipCode&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;Model&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
code &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; &amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt; &amp;lt;span class="token comment" spellcheck="true"&gt;# Same as before&amp;lt;/span&gt;
municipality &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;CharField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;max_length&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token number"&gt;2&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=" language-sh"&gt;&lt;code&gt;python manage.py makemigrations -n break_zipcode_muni_foreignkey&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;现在，·Municipality·modle 没有被任何外键所 refer，我们可以在上面进行工作了。&lt;/p&gt;
&lt;p&gt;增加一个新的 id field：&lt;/p&gt;
&lt;pre class=" language-python"&gt;&lt;code class=" language-python"&gt;&amp;lt;span class="token keyword"&gt;class&amp;lt;/span&gt; &amp;lt;span class="token class-name"&gt;Municipality&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;Model&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
id &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;UUIDField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;default&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;uuid&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;uuid4&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=" language-sh"&gt;&lt;code&gt;python manage.py makemigrations -n add_id_field_to_muni&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;处于某些原因，默认值在我的案例中不 work，所以我增加了一个过程到创建的 migration，来创建新的唯一 id。&lt;/p&gt;
&lt;pre class=" language-python"&gt;&lt;code class=" language-python"&gt;&amp;lt;span class="token keyword"&gt;def&amp;lt;/span&gt; &amp;lt;span class="token function"&gt;create_ids&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;apps&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; schema_editor&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
Municipality &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; apps&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;get_model&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'loc'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; &amp;lt;span class="token string"&gt;'Municipality'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
&amp;lt;span class="token keyword"&gt;for&amp;lt;/span&gt; m &amp;lt;span class="token keyword"&gt;in&amp;lt;/span&gt; municipality&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
m&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;id &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; uuid&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;uuid4&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
m&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;save&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
&amp;lt;span class="token comment" spellcheck="true"&gt;# ...&amp;lt;/span&gt;
operations &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; &amp;lt;span class="token punctuation"&gt;[&amp;lt;/span&gt;
migrations&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;AddField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
migrations&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;RunPython&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;code&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;create_ids&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
&amp;lt;span class="token punctuation"&gt;]&amp;lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;现在我们有一个&lt;code&gt;UUID&lt;/code&gt; ·id·field 在·Municipality 中，然后我们应该可以更换主键了。&lt;/p&gt;
&lt;pre class=" language-python"&gt;&lt;code class=" language-python"&gt;&amp;lt;span class="token keyword"&gt;class&amp;lt;/span&gt; &amp;lt;span class="token class-name"&gt;Municipality&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;Model&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
id &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;UUIDField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;default&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;uuid&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;uuid4&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; primary_key&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token boolean"&gt;True&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
code &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;CharField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;max_length&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token number"&gt;2&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; unique&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token boolean"&gt;True&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;创建 migration，并且确保在&lt;code&gt;code&lt;/code&gt;上的&lt;code&gt;AlterField&lt;/code&gt;操作在&lt;code&gt;id&lt;/code&gt;之前。我们已经在&lt;code&gt;id&lt;/code&gt;上增加了&lt;code&gt;primary_key&lt;/code&gt;并且增加了 unique=True 到&lt;code&gt;code&lt;/code&gt; field。constraint 没了，在我们删除 primary_key 的时候就没了。&lt;/p&gt;
&lt;p&gt;让我们开始一个空的迁移&lt;/p&gt;
&lt;pre class=" language-sh"&gt;&lt;code&gt;python manage.py makemigrations --empty -n fix_zipcode_fk_to_muni_uuid loc&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;打开文件，输入&lt;/p&gt;
&lt;pre class=" language-python"&gt;&lt;code class=" language-python"&gt;&amp;lt;span class="token keyword"&gt;def&amp;lt;/span&gt; &amp;lt;span class="token function"&gt;match&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;apps&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; schema_editor&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
ZipCode &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; apps&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;get_model&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'loc'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; &amp;lt;span class="token string"&gt;'ZipCode'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
Muni &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; apps&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;get_model&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'loc'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; &amp;lt;span class="token string"&gt;'Municipality'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
&amp;lt;span class="token keyword"&gt;for&amp;lt;/span&gt; zip_code &amp;lt;span class="token keyword"&gt;in&amp;lt;/span&gt; ZipCode&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;object&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;all&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
zip_code&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;temp_muni &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; Muni&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;get&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;code&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;z&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;municipality&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
zip_code&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;save&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
&amp;lt;span class="token comment" spellcheck="true"&gt;# ...&amp;lt;/span&gt;
operations &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; &amp;lt;span class="token punctuation"&gt;[&amp;lt;/span&gt;
migrations&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;AddField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;
model_name&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'zipcode'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
name&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'temp_muni'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
field&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;UUIDField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;null&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token boolean"&gt;True&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
migrations&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;RunPython&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;code&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;match&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
migrations&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;RemoveField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;model_name&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'zipcode'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; name&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'municipality'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
migrations&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;RenameField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;
model_name&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'zipcode'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; old_name&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'temp_muni'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; new_name&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'municipality'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
migrations&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;AlterField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;
model_name&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'zipcode'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
name&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'municipality'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
field&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;ForeignKey&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;
on_delete&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;django&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;db&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;models&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;deletion&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;PROTECT&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
to&amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'municipality'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
&amp;lt;span class="token punctuation"&gt;]&amp;lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;增加一个临时的field来保存 Municipality 的UUID，我们不让他是一个&lt;code&gt;ForeignKey&lt;/code&gt;field，否则 Django confuse。&lt;/li&gt;
&lt;li&gt;我们运行 match 函数来寻找新的 id，通过寻找旧的 key，并且存储到临时的 field。&lt;/li&gt;
&lt;li&gt;删除旧的 municipality field&lt;/li&gt;
&lt;li&gt;重命名临时 field 到 municipality&lt;/li&gt;
&lt;li&gt;最后迁移到一个外键，然后创建我们需要 constraint&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;译者：这样改最大的好处就是改了 UUID，但是没有破坏之前的逻辑，可以说是谨慎的迁移吧。不过线上的数据既然在跑着，就这么迁移了，会不会出问题呢。&lt;/pre&gt;
&lt;p&gt;下面还有一些内容。自从我们将 migrations 分离成多个文件，我们让代码变得很脆弱（如果后面的某些 migrations 失败了）。这将会让我们的应用进入一个 unworkable 的状态。所以确保测试一下migrations。你可通过手工把这所有的步骤整合到一个migration里，但是如果你有来自多个不同app的 reference，你可能需要把这些步骤再分开。&lt;/p&gt;
&lt;h2 id="logging"&gt;logging
&lt;/h2&gt;&lt;p&gt;迁移的过程中，你可能遇到很多问题，所以一个比较不错的方式，是创建一个简单的迁移 logging。&lt;/p&gt;
&lt;pre class=" language-python"&gt;&lt;code class=" language-python"&gt;&amp;lt;span class="token keyword"&gt;def&amp;lt;/span&gt; &amp;lt;span class="token function"&gt;log&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;message&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
&amp;lt;span class="token keyword"&gt;def&amp;lt;/span&gt; &amp;lt;span class="token function"&gt;fake_op&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;apps&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt; schema_editor&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;:&amp;lt;/span&gt;
&amp;lt;span class="token keyword"&gt;print&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;message&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;
&amp;lt;span class="token keyword"&gt;return&amp;lt;/span&gt; fake_op
&amp;lt;span class="token comment" spellcheck="true"&gt;# ...&amp;lt;/span&gt;
operations &amp;lt;span class="token operator"&gt;=&amp;lt;/span&gt; &amp;lt;span class="token punctuation"&gt;[&amp;lt;/span&gt;
migration&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;RunPython&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;log&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'Step 1'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
migration&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;AlterField&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
migration&amp;lt;span class="token punctuation"&gt;.&amp;lt;/span&gt;RunPython&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;log&amp;lt;span class="token punctuation"&gt;(&amp;lt;/span&gt;&amp;lt;span class="token string"&gt;'Step 2'&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;)&amp;lt;/span&gt;&amp;lt;span class="token punctuation"&gt;,&amp;lt;/span&gt;
&amp;lt;span class="token comment" spellcheck="true"&gt;# ...&amp;lt;/span&gt;
&amp;lt;span class="token punctuation"&gt;]&amp;lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;想要观察 Django 运行了那些 SQL 语句，运行&lt;code&gt;python manage.py sqlmigrate &amp;lt;appname&amp;gt;&amp;lt;migration_number&amp;gt;&lt;/code&gt;，这是一个超级有用的方法。&lt;/p&gt;
&lt;p&gt; &lt;/p&gt;</description></item><item><title>Django 写个过滤器 filter</title><link>https://svtter.cn/p/django-%E5%86%99%E4%B8%AA%E8%BF%87%E6%BB%A4%E5%99%A8-filter/</link><pubDate>Mon, 05 Nov 2018 01:00:00 +0800</pubDate><guid>https://svtter.cn/p/django-%E5%86%99%E4%B8%AA%E8%BF%87%E6%BB%A4%E5%99%A8-filter/</guid><description>&lt;p&gt;用 Django 快速开发一个项目，发现 Django 的模板本身不带有整除功能，因此自己手写一个。&lt;/p&gt;
&lt;pre class="wp-block-code"&gt;&lt;code class=""&gt;├── templates
│   ├── app
│   └── base
├── templatetags
│   ├── app_extras.py
│   ├── __init__.py
│   └── __pycache__
├── tests.py
├── urls.py
├── utils.py
└── views.py
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这是目录结构。在 urls.py 添加 app 的名称，例如 app_name = ‘app’ ，然后在与models.py 同级的目录下，新建一个 python 包， templatetags 的，新建自己需要的包名即可。&lt;/p&gt;
&lt;p&gt;app_extra.py：&lt;/p&gt;
&lt;pre class="wp-block-code"&gt;&lt;code lang="php" class="language-php"&gt;from django import template
register = template.Library()
def mod(value):
return value % 11
register.filter('mod', mod)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里因为需求比较简单，因此直接就赋值了 11.&lt;/p&gt;
&lt;p&gt;应用到模板中：&lt;/p&gt;
&lt;pre class="wp-block-code"&gt;&lt;code class=""&gt;{% load app_extra %}
{% for image in image_list %}
{% if forloop.counter|mod == 0 %}
&amp;lt;h3&gt;检查点&amp;lt;/h3&gt;
{% endif %}
{% endfor %}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;随后即可看到结果。&lt;/p&gt;
&lt;p&gt;此外，寻得两个比较好用 template 插件&lt;figure class="wp-block-embed"&gt;&lt;/p&gt;
&lt;div class="wp-block-embed__wrapper"&gt;
https://pypi.org/project/django-bootstrap4/
&lt;/div&gt;&lt;/figure&gt; &lt;figure class="wp-block-embed"&gt;
&lt;div class="wp-block-embed__wrapper"&gt;
https://github.com/timonweb/django-bulma
&lt;/div&gt;&lt;/figure&gt;
&lt;p&gt;实现的东西虽然不多，但是起码把我不想关心的逻辑封装起来了。。&lt;/p&gt;</description></item><item><title>Visual Studio Code Tips - 0</title><link>https://svtter.cn/p/visual-studio-code-tips-0/</link><pubDate>Sat, 24 Feb 2018 01:00:00 +0800</pubDate><guid>https://svtter.cn/p/visual-studio-code-tips-0/</guid><description>&lt;p&gt;使用vscode进行&lt;code&gt;django&lt;/code&gt;开发的时候，总会出现一些错误，比如说对&lt;code&gt;Django&lt;/code&gt;的一些结构进行错误的报错；&lt;/p&gt;
&lt;p&gt;这个时候可以安装&lt;code&gt;pylint-django&lt;/code&gt;这个插件。&lt;/p&gt;
&lt;p&gt;安装方法：&lt;code&gt;pip install pylint-django&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;使用：&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;.vscode/&lt;/code&gt;配置文件中增加：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;pylint.args&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;load-plugins=pylint_django&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;即可。&lt;/p&gt;
&lt;h2 id="参考"&gt;参考
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://stackoverflow.com/questions/45135263/class-has-no-objects-member" target="_blank" rel="noopener"
&gt;https://stackoverflow.com/questions/45135263/class-has-no-objects-member&lt;/a&gt;&lt;/p&gt;</description></item><item><title>使用Docker时遇到的sitemap问题</title><link>https://svtter.cn/p/%E4%BD%BF%E7%94%A8docker%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84sitemap%E9%97%AE%E9%A2%98/</link><pubDate>Wed, 27 Dec 2017 01:00:00 +0800</pubDate><guid>https://svtter.cn/p/%E4%BD%BF%E7%94%A8docker%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84sitemap%E9%97%AE%E9%A2%98/</guid><description>&lt;p&gt;这两天感觉博客访问量已经不能靠用嘴宣传了，于是决定做一下sitemap，但是发现django自带的sitemap生成器存在这样的问题：生成的sitemap是依照container的hostname来显示的。&lt;/p&gt;
&lt;p&gt;为此我查询了一下其他人是怎么搞的，发现他们都把nginx和django放在一个容器下——但是如此构建不仅麻烦，似乎违背了docker的构建思路，在一个container里面放了多个进程。因此，我认为下面的方案是合理的。&lt;/p&gt;
&lt;h2 id="解决方案"&gt;解决方案
&lt;/h2&gt;&lt;h3 id="enabling-the-sites-framework"&gt;Enabling the sites framework
&lt;/h3&gt;&lt;p&gt;To enable the sites framework, follow these steps:&lt;/p&gt;
&lt;p&gt;Add ‘django.contrib.sites’ to your INSTALLED_APPS setting.&lt;/p&gt;
&lt;h3 id="define-a-site_id-setting"&gt;Define a SITE_ID setting:
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;SITE_ID = 1&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="run-migrate"&gt;Run migrate.
&lt;/h3&gt;&lt;p&gt;django.contrib.sites registers a post_migrate signal handler which creates a default site named example.com with the domain example.com. This site will also be created after Django creates the test database. To set the correct name and domain for your project, you can use a data migration.&lt;/p&gt;
&lt;p&gt;In order to serve different sites in production, you’d create a separate settings file with each SITE_ID (perhaps importing from a common settings file to avoid duplicating shared settings) and then specify the appropriate DJANGO_SETTINGS_MODULE for each site.&lt;/p&gt;
&lt;div class="codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;django.contrib.sites.models&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Site&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;one&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Site&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;objects&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="mi"&gt;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;one&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;domain&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;myveryspecialdomain.com&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;one&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;My Special Site Name&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;one&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;save&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;代码写多了，对于Flask和Django也就十分释然了。两个东西都是利器，针对的东西不是很相同；编程语言也是，都有自己擅长的部分，如果你非要用某种编程语言花很大的力气去做一件小事，除非你是geek而且有追求，并且没有deadline在旁边催催催，否则不建议你这么做。&lt;/p&gt;
&lt;h2 id="参考项目"&gt;参考项目
&lt;/h2&gt;&lt;p&gt;&lt;a class="link" href="https://github.com/flyhigher139/mayblog" target="_blank" rel="noopener"
&gt;https://github.com/flyhigher139/mayblog&lt;/a&gt;&lt;/p&gt;</description></item></channel></rss>