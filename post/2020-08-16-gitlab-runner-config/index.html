



<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="Keywords" content="python,svtter,django,软件架构,公众号,小程序,博客,项目管理,">

 


      <title>⚙ 记录一次 gitlab runner 的配置 - </title>

  <meta name="description" content="首先介绍一下整体的情况，和我们的需求。


在我们组里，不同的项目和服务，被分到不同的 repo 中，托管在 gitlab 上面。


最近一段时间，由于构建的时间变长，用掉了 gitlab 免费的 2000 minutes。


因此，打算采用自己的 runner，来进行服务的构建和使用。
Gitlab runner 配置有些神奇。">
  <meta name="author" content="svtter"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Svtter\u0027s Blog",
    
    "url": "http:\/\/192.168.2.39:1313\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "http:\/\/192.168.2.39:1313\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "http:\/\/192.168.2.39:1313\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "http:\/\/192.168.2.39:1313\/post\/2020-08-16-gitlab-runner-config\/",
          "name": "记录一次 gitlab runner 的配置"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "svtter"
  },
  "headline": "⚙ 记录一次 gitlab runner 的配置",
  "description" : "首先介绍一下整体的情况，和我们的需求。\n在我们组里，不同的项目和服务，被分到不同的 repo 中，托管在 gitlab 上面。\n最近一段时间，由于构建的时间变长，用掉了 gitlab 免费的 2000 minutes。\n因此，打算采用自己的 runner，来进行服务的构建和使用。\nGitlab runner 配置有些神奇。\n",
  "inLanguage" : "zh-cn",
  "wordCount":  135 ,
  "datePublished" : "2020-08-17T08:44:46\u002b08:00",
  "dateModified" : "2020-08-17T08:44:46\u002b08:00",
  "image" : "http:\/\/192.168.2.39:1313\/",
  "keywords" : [ "CI, GitLab" ],
  "mainEntityOfPage" : "http:\/\/192.168.2.39:1313\/post\/2020-08-16-gitlab-runner-config\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "http:\/\/192.168.2.39:1313\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "http:\/\/192.168.2.39:1313\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="⚙ 记录一次 gitlab runner 的配置" />
<meta property="og:description" content="首先介绍一下整体的情况，和我们的需求。


在我们组里，不同的项目和服务，被分到不同的 repo 中，托管在 gitlab 上面。


最近一段时间，由于构建的时间变长，用掉了 gitlab 免费的 2000 minutes。


因此，打算采用自己的 runner，来进行服务的构建和使用。
Gitlab runner 配置有些神奇。">
<meta property="og:url" content="http://192.168.2.39:1313/post/2020-08-16-gitlab-runner-config/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Svtter&#39;s Blog" />

  <meta name="twitter:title" content="⚙ 记录一次 gitlab runner 的配置" />
  <meta name="twitter:description" content="首先介绍一下整体的情况，和我们的需求。


在我们组里，不同的项目和服务，被分到不同的 repo 中，托管在 gitlab 上面。


最近一段时间，由于构建的时间变长，用掉了 gitlab 免费的 2000 minutes。


因此，打算采用自己的 runner，来进行服务的构建和使用。
Gitlab runner 配置有些神奇。">
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@Crack_svtter" />
  <meta name="twitter:creator" content="@Crack_svtter" />
  <meta name="generator" content="Hugo 0.130.0">
  <link rel="alternate" href="http://192.168.2.39:1313/index.xml" type="application/rss+xml" title="Svtter&#39;s Blog"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="http://192.168.2.39:1313/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="http://192.168.2.39:1313/css/highlight.min.css" /><link rel="stylesheet" href="http://192.168.2.39:1313/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://192.168.2.39:1313/">Svtter&#39;s Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Categories" href="/categories/">Categories</a>
            </li>
          
        
          
            <li>
              <a title="Daily ML" href="/daily-ml/">Daily ML</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags/">Tags</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        

        
          
            <li>
              
            </li>
          
        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>⚙ 记录一次 gitlab runner 的配置</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;发表于 August 17, 2020
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;分钟
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;135&nbsp;个字
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;svtter
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>首先介绍一下整体的情况，和我们的需求。</p>
<ol>
<li>
<p>在我们组里，不同的项目和服务，被分到不同的 repo 中，托管在 gitlab 上面。</p>
</li>
<li>
<p>最近一段时间，由于构建的时间变长，用掉了 gitlab 免费的 2000 minutes。</p>
</li>
</ol>
<p>因此，打算采用自己的 runner，来进行服务的构建和使用。</p>
<p>Gitlab runner 配置有些神奇。</p>
<h2 id="-技术背景">🔙 技术背景</h2>
<p>在这之前，我们已经单给 <code>data_service</code> 部署了一个 <code>gitlab-runner</code>。这是由于<code>data-service</code> 跑 CI 的时间格外长，因此单独进行了配置。</p>
<p>但是没有想到的是，backend-service 耗尽了所有的 gitlab 分钟数。</p>
<p>​		本文花费了作者 <code>$8</code> 。如果可以的话，请支持一下作者。</p>
<h2 id="-gitlab-runner-概念">🏃‍♂️ Gitlab Runner 概念</h2>
<p>CI 是由 jobs 组成的；</p>
<p>pipeline 是由多个 jobs 组成。</p>
<p>官方文档声称，在 gitlab 中，没有<code>shared runner</code>，就不能启动 jobs 了。</p>
<p>但其实，只要有 <code>group runner</code> 或者 <code>specific runner</code> （也就是我们自己配置的 runner），job 也可以正常运行。</p>
<p>要注意一下 <code>tag</code> 选项。<code>tag</code> 选项，并非单纯的对 <code>runner</code> 进行区分。项目也会依据<code>tag</code>，被分配给不同的<code>runner</code>。</p>
<p>不过，我们在最初配置<code>runner</code>时不清楚这一点。我们还以为，就是官方所声称的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">Shared Runners on GitLab.com run in autoscale mode and are powered by Google Cloud Platform. Autoscaling means reduced wait times to spin up builds, and isolated VMs for each project, thus maximizing security.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">They&#39;re free to use for public open source projects and limited to 2000 CI minutes per month per group for private projects. Read about all GitLab.com plans.
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>因此给<code>gitlab</code>进行了一下信仰充值。后来发觉似乎充值之后，我们配置的<code>group runner</code>也没有开始运行。</p>
<p>最后我们定位到<code>runner</code>的<code>tag</code>问题，最终暂时移除了<code>tag</code>，解决了问题。</p>
<p>希望 <code>gitlab</code> 能够发展的越来越好。希望<code>Mozilla</code>支撑下去。</p>

        
          <div class="blog-tags">
            
              
              <a href="http://192.168.2.39:1313/tags/ci/">CI</a>&nbsp;
            
              
              <a href="http://192.168.2.39:1313/tags/gitlab/">GitLab</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=http%3a%2f%2f192.168.2.39%3a1313%2fpost%2f2020-08-16-gitlab-runner-config%2f&amp;text=%e2%9a%99%20%e8%ae%b0%e5%bd%95%e4%b8%80%e6%ac%a1%20gitlab%20runner%20%e7%9a%84%e9%85%8d%e7%bd%ae&amp;via=Crack_svtter" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2f192.168.2.39%3a1313%2fpost%2f2020-08-16-gitlab-runner-config%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=http%3a%2f%2f192.168.2.39%3a1313%2fpost%2f2020-08-16-gitlab-runner-config%2f&amp;title=%e2%9a%99%20%e8%ae%b0%e5%bd%95%e4%b8%80%e6%ac%a1%20gitlab%20runner%20%e7%9a%84%e9%85%8d%e7%bd%ae" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=http%3a%2f%2f192.168.2.39%3a1313%2fpost%2f2020-08-16-gitlab-runner-config%2f&amp;title=%e2%9a%99%20%e8%ae%b0%e5%bd%95%e4%b8%80%e6%ac%a1%20gitlab%20runner%20%e7%9a%84%e9%85%8d%e7%bd%ae" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=http%3a%2f%2f192.168.2.39%3a1313%2fpost%2f2020-08-16-gitlab-runner-config%2f&amp;title=%e2%9a%99%20%e8%ae%b0%e5%bd%95%e4%b8%80%e6%ac%a1%20gitlab%20runner%20%e7%9a%84%e9%85%8d%e7%bd%ae" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=http%3a%2f%2f192.168.2.39%3a1313%2fpost%2f2020-08-16-gitlab-runner-config%2f&amp;description=%e2%9a%99%20%e8%ae%b0%e5%bd%95%e4%b8%80%e6%ac%a1%20gitlab%20runner%20%e7%9a%84%e9%85%8d%e7%bd%ae" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="http://192.168.2.39:1313/post/2020-08-14-learning-spring/" data-toggle="tooltip" data-placement="top" title="Learning spring ROO">&larr; 前一篇</a>
            </li>
          
          
            <li class="next">
              <a href="http://192.168.2.39:1313/post/2020-08-19-gitee-story/" data-toggle="tooltip" data-placement="top" title="Gitee Story">后一篇 &rarr;</a>
            </li>
          
        </ul>
      


      
      
      
      
      
        
      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="https://github.com/svtter" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://twitter.com/Crack_svtter" title="Twitter">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              svtter
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2024
          

          
            &nbsp;&bull;&nbsp;
            <a href="http://192.168.2.39:1313/">Svtter&#39;s Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          由 <a href="https://gohugo.io">Hugo v0.130.0</a> 强力驱动 &nbsp;&bull;&nbsp; 主题 <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> 移植自 <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="http://192.168.2.39:1313/js/main.js"></script>
<script src="http://192.168.2.39:1313/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="http://192.168.2.39:1313/js/load-photoswipe.js"></script>










    
  </body>
</html>

